# LLM Backend API

–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–¥ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –¥–ª—è —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è *–±—ç–∫–µ–Ω–¥–∞ —Å–µ—Ä–≤–∏—Å–∞ –∑–∞–º–µ—Ç–æ–∫* (—Å–∞–º–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è üëâ [—Ç—É—Ç](https://github.com/Kridalll/SteroidnotesFront) `[WIP]`), –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–≤—è–∑–∞–Ω–Ω–æ–π —Å –Ω–µ–π—Ä–æ–Ω–Ω—ã–º–∏ —Å–µ—Ç—è–º–∏ –≤ —Ñ–æ—Ä–º–µ REST API.

- Python –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—É—Å–∫–∞ –º–æ–¥–µ–ª–µ–π –≤ –æ–±–ª–∞–∫–µ, RAG –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞ [`streamlit`](https://docs.streamlit.io/) –≤ [–æ—Ç–¥–µ–ª—å–Ω–æ–π –≤–µ—Ç–∫–µ](https://github.com/imanchoys/hug-llm-api/tree/langch-for-pdf/talk-with-pdf)
- –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å—Ç–∏—Ç—å LLM –ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –∂–µ –≤ –æ–±–ª–∞–∫–µ
- —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è API (FastAPI) –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–æ–¥–µ–ª–µ–π: `Saiga-Mistral-7b`, `Kandinsky 2`, `mbart-ru-gazeta`


–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è —Å–±–æ—Ä–∫–∏ **–æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞** —É–∫–∞–∑–∞–Ω—ã –≤ —Ñ–∞–π–ª–µ: [`api/requirements.txt`](https://github.com/imanchoys/hug-llm-api/tree/main/api/requirements.txt)

```config
auto_gptq==0.5.1
autollm==0.0.22
chromadb==0.4.18
chromadb==0.4.17
ctransformers==0.2.27
diffusers==0.23.0
fastapi==0.109.0
gradio==4.14.0
huggingface_hub==0.19.4
langchain==0.1.1
loguru==0.7.2
modal==0.55.4091
peft==0.6.1
Pillow==10.2.0
rich==13.7.0
torch==2.1.0
transformers==4.35.2
llama-cpp-python==0.2.24
```

## –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

> Python –≤–µ—Ä—Å–∏—è (>=): **3.11**

- —Å–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
  
  ```bash
  pyenv local 3.11.5
  python -m venv .venv
  ```

- —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫ —á–µ—Ä–µ–∑ `pip`:
  
  ```bash
  pip install -r api/requirements.txt
  ```

- –ø—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–∏, —Ñ–∞–π–ª –º–æ–¥–µ–ª–∏ –Ω–µ–π—Ä–æ–Ω–Ω–æ–π —Å–µ—Ç–∏ –±—É–¥–µ—Ç —Å–∫–∞—á–∏–≤–∞—Ç—å—Å—è —Å [huggingface](https://huggingface.co/) –∏ –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å <u>–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π</u> –æ–±—ä—ë–º –Ω–∞ –¥–∏—Å–∫–µ (~2-10 GB)

- –∑–∞–ø—É—Å–∫ API [Saiga Mistral 7b GGUF](https://huggingface.co/IlyaGusev/saiga_mistral_7b_lora):

    ```bash
    python api/local_saiga_mistral_7b_gguf_fastapi.py
    ```

## –£–¥–∞–ª—ë–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ —á–µ—Ä–µ–∑ –æ–±–ª–∞–∫–æ Modal

–°–µ—Ä–≤–∏—Å [*Modal*](modal.com) –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è API –≤–º–µ—Å—Ç–µ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –Ω–∞ –∏—Ö –¥–æ–º–µ–Ω–µ, –∏—Å–ø–æ–ª—å–∑—É—è –æ–±–ª–∞—á–Ω—ã–µ GPU.

–ß—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –æ–±–ª. –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ modal –Ω—É–∂–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ –∞–∫–∫–∞—É–Ω—Ç–µ —Å –ø–æ–º–æ—â—å—é CLI, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è:

```bash
pip install modal # —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ CLI
python3 -m modal setup # –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –±—Ä–∞—É–∑–µ—Ä –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –∞–∫–∫–∞—É–Ω—Ç, –∑–∞—Ç–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
```

–ß—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞–∫—É—é-–ª–∏–±–æ (–≤ –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ [Kandinsky 2.2](https://huggingface.co/kandinsky-community/kandinsky-2-2-prior)) –Ω–µ–π—Ä–æ—Å–µ—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å (–∫–∞–∫ —Å–µ—Ä–≤–∏—Å –∏ API) –≤ modal-–æ–±–ª–∞–∫–æ –≤—ã–ø–æ–ª–Ω—è–µ–º:

```bash
modal deploy api/modal_kandinsky_2_2.py 
```

> - –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ, –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ **–º–æ–∂–µ—Ç –±—ã—Ç—å** –Ω—É–∂–µ–Ω —Ñ–∞–π–ª (`api/frontend/index.html`) —Å –ø—Ä–æ—Å—Ç—ã–º html —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º, –≤ —Ç–æ–º —Å–ª—É—á–∞–µ –µ—Å–ª–∏ —Å–µ—Ä–≤–∏—Å –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç UI.
> - Modal –∏—Å–ø–æ–ª—å–∑—É–µ—Ç [containerd](https://github.com/containerd/containerd) –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω–æ–π —Å–±–æ—Ä–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è ‚û°Ô∏è –Ω–µ –≤—Å–µ–≥–¥–∞ –≤—Å—ë —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞, –≤–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –∑–∞–º–µ–Ω–∏—Ç—å –≤–µ—Ä—Å–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫ –ø—É—Ç—ë–º –∏–∑–º–µ–Ω–µ–Ω–∏—è [–∫–æ–¥–∞ –æ—Ç–≤. –∑–∞ —ç—Ç–æ](https://modal.com/docs/guide/custom-container)

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞ –≤ –æ–±–ª–∞–∫–µ

![–ø—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å modal](pics/screencap_01.gif)

## –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å Saiga-Mistral –ª–æ–∫–∞–ª—å–Ω–æ

![—Ä–∞–±–æ—Ç–∞ —Å mistral –ª–æ–∫–∞–ª—å–Ω–æ](pics/screencap_02.gif)
